# Based on https://github.com/actions-rs/meta/blob/master/recipes/quickstart.md
#
# History:
#   1. 2023-02-14: Created at 2023-02-14T16:00:00Z by Quanyi Ma <eli@patch.sh>
#
#
#

on: [ push, pull_request ]

name: Base GitHub Action for Check, Test and Lints

jobs:

  cargo-check:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
        with:
          submodules: 'recursive'
          
      - name: Build Docker Container
        run: docker build . -f .devcontainer/Dockerfile -t my-dev-container

      - name: Run cargo check inside the Docker Container
        run: docker run --rm my-dev-container /bin/sh -c "cargo check --workspace --all-targets --all-features"

  clippy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
      with:
        submodules: 'recursive'

    - name: Build Docker Container
      run: docker build . -f .devcontainer/Dockerfile -t my-dev-container

    - name: Install clippy and Run checks inside the Docker Container
      run: |
        docker run --rm my-dev-container /bin/sh -c "\
          rustup component add clippy && \
          cargo clippy --workspace --all-targets --all-features -- -D warnings"
  
  cargo-check:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
        with:
          submodules: 'recursive'
          
      - name: Build Docker Container
        run: docker build . -f .devcontainer/Dockerfile -t my-dev-container

      - name: Run cargo check inside the Docker Container
        run: docker run --rm my-dev-container /bin/sh -c "cargo doc --workspace --all-targets --all-features"